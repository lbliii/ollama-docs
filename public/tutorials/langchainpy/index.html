<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<meta name="title" content="MiloDocs: " />
<meta name="description" content="Using LangChain with Ollama in Python # Let&rsquo;s imagine we are studying the classics, such as the Odyssey by Homer. We might have a question about Neleus and his family. If you ask llama2 for that info, you may get something like:
I apologize, but I&rsquo;m a large language model, I cannot provide information on individuals or families that do not exist in reality. Neleus is not a real person or character, and therefore does not have a family or any other personal details." />
<meta name="keywords" content="[]" />
<meta name="author" content="" />


<title> | MiloDocs</title>

  <link rel="stylesheet" href="/css/bundle.css">
<script src="/js/bundle.cca7746894b8b9b1c4052fd8b832a8e218fe49bcae077ac61493efc3f7ab4e71.js" integrity="sha256-zKd0aJS4ubHEBS/YuDKo4hj&#43;SbyuB3rGFJPvw/erTnE=" crossorigin="anonymous"></script>

</head>
<body class="bg-white">
  <header>
</header><nav id="topNav" class="sticky top-0 z-50 py-2 bg-white">
    <div class="max-w-screen-xl 2xl:max-w-screen-2xl mx-auto">
        <div id="topNavItemsContainer" class="flex space-x-2">
            <a href="/" class="flex items-center">
    <span class="w-5 h-5">
            <img src="/images/milo.png" alt="Logo Small" class="w-5"></span>
</a>

<div id="topNavLinks" class="flex items-center mx-2 space-x-4 text-black transition duration-300 justify-start w-1/3 font-brand font-light text-sm">
        <a href="/" aria-label="Home" class="hidden md:block">Home</a><a href="/get-started/" aria-label="Get Started" class="hidden md:block">Get Started</a>
    
    <div id="topNavPrimaryDropdown" class="hidden md:block relative group z-50">
        <a href="/" aria-label="Dropdown" class="">Dropdown</a>
        <div class="absolute left-0 mt-0 w-48 bg-white border border-gray-200 rounded-md overflow-hidden shadow-lg group-hover:block hidden p-1"><a href="/about" aria-label="About Us" class="flex px-4 py-1 text-sm text-black hover:bg-zinc-100 transition duration-100">About Us</a><a href="/services" aria-label="Services" class="flex px-4 py-1 text-sm text-black hover:bg-zinc-100 transition duration-100">Services</a><a href="/contact" aria-label="Contact" class="flex px-4 py-1 text-sm text-black hover:bg-zinc-100 transition duration-100">Contact</a></div>
    </div></div>
<div id="topNavSearch" class="flex items-center space-x-4 text-xs">
    <input type="search" id="searchInput" class="border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-brand md:w-96 bg-zinc-100 text-black" placeholder="Search..." aria-label="Search" />
</div><div id="topNavEnd" class="flex w-1/3 justify-end">
                
                <div class="flex items-center space-x-4">
                    <button id="chatTocToggle" aria-label="Toggle Chat" class="hidden md:block"><span class="w-5 h-5"><img id="chatRob" src="/icons/robot.svg" alt="toggle" class="hidden" title="Chat Panel"><img id="chatToc" src="/icons/toc.svg" alt="toggle" class="hidden" title="TOC Panel"></span></button>
                    <button id="darkModeToggle" aria-label="Toggle Darkmode"><span class="w-5 h-5"><img id="moon" src="/icons/dark.svg" alt="moon" class="hidden" title="Dark Mode"><img id="sun" src="/icons/light.svg" alt="sun" class="hidden" title="Light Mode"></span></button>
                </div>
            </div>
        </div>
    </div>
</nav><main class="max-w-screen-xl 2xl:max-w-screen-2xl mx-auto flex"><aside id="sidebar-left" class="hidden md:flex md:translate-x-0 w-60 text-black">
    <div id="linkTree" class="sticky top-10 pt-4 h-[calc(100vh-4rem)] overflow-y-auto w-full">
        
        
        
    </div>
</aside>




<div id="pageContainer" class="w-full lg:w-3/5"><section id="articleSummarizationContainer" class="hidden border border-dotted m-4 p-4 rounded-md transition-opacity duration-500">
    <h2 class="text-3xl font-bold text-black mb-4">Article Summarization</h2>
    <div id="articleSummaryOutput" class="flex items-center justify-center p-4 my-4 bg-zinc-100 rounded-md text-black text-sm transition-all duration-300 ease-in-out">
        <div class="animate-spin h-5 w-5 mr-3 border-4 border-brand rounded-full border-t-transparent"></div>
        <p id="generationMessage">Generating summary...</p>
    </div>
</section>

  <div class="my-4">
    <nav aria-label="Breadcrumb Navigation" class="breadcrumb flex flex-wrap text-xs px-2 items-center md:px-4">
  <ol class="flex space-x-2 md:space-x-4 lg:space-x-6">
    
    <li>
      <a href="//localhost:1313/tutorials/langchainpy/" class="text-black px-2 py-1 md:px-4 md:py-2 lg:px-6 rounded shadow-md block tile transition duration-300" aria-label="Breadcrumb Item" aria-current="page">
          
      </a>
    </li>
  </ol>
</nav>

  </div>
  <h1 class="text-black p-4"></h1>
  <div id="articleContent" class="p-4">
    



<h1 id="using-langchain-with-ollama-in-python" class="group block ">
    Using LangChain with Ollama in Python
    <a id="-using-langchain-with-ollama-in-python" href="#-using-langchain-with-ollama-in-python" class="hidden group-hover:inline text-current ml-2">#</a>
</h1><p>Let&rsquo;s imagine we are studying the classics, such as <strong>the Odyssey</strong> by <strong>Homer</strong>. We might have a question about Neleus and his family. If you ask llama2 for that info, you may get something like:</p>
<blockquote>
<p>I apologize, but I&rsquo;m a large language model, I cannot provide information on individuals or families that do not exist in reality. Neleus is not a real person or character, and therefore does not have a family or any other personal details. My apologies for any confusion. Is there anything else I can help you with?</p>
</blockquote>
<p>This sounds like a typical censored response, but even llama2-uncensored gives a mediocre answer:</p>
<blockquote>
<p>Neleus was a legendary king of Pylos and the father of Nestor, one of the Argonauts. His mother was Clymene, a sea nymph, while his father was Neptune, the god of the sea.</p>
</blockquote>
<p>So let&rsquo;s figure out how we can use <strong>LangChain</strong> with Ollama to ask our question to the actual document, the Odyssey by Homer, using Python.</p>
<p>Let&rsquo;s start by asking a simple question that we can get an answer to from the <strong>Llama2</strong> model using <strong>Ollama</strong>. First, we need to install the <strong>LangChain</strong> package:</p>
<p><code>pip install langchain</code></p>
<p>Then we can create a model and ask the question:</p>
<div class="codeblock relative bg-zinc-800 rounded text-sm p-4">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain_community.llms <span style="color:#f92672">import</span> Ollama
</span></span><span style="display:flex;"><span>ollama <span style="color:#f92672">=</span> Ollama(
</span></span><span style="display:flex;"><span>    base_url<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http://localhost:11434&#39;</span>,
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;llama3&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>print(ollama<span style="color:#f92672">.</span>invoke(<span style="color:#e6db74">&#34;why is the sky blue&#34;</span>))</span></span></code></pre></div>
    <button class="copy-btn absolute top-2 right-2 bg-zinc-600 hover:bg-zinc-900 transition duration-300 text-white rounded px-2 py-1 text-xs focus:outline-none" onclick="copyCodeToClipboard(this)">Copy</button>
</div>

<p>Notice that we are defining the model and the base URL for Ollama.</p>
<p>Now let&rsquo;s load a document to ask questions against. I&rsquo;ll load up the Odyssey by Homer, which you can find at Project Gutenberg. We will need <strong>WebBaseLoader</strong> which is part of <strong>LangChain</strong> and loads text from any webpage. On my machine, I also needed to install <strong>bs4</strong> to get that to work, so run <code>pip install bs4</code>.</p>
<div class="codeblock relative bg-zinc-800 rounded text-sm p-4">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain.document_loaders <span style="color:#f92672">import</span> WebBaseLoader
</span></span><span style="display:flex;"><span>loader <span style="color:#f92672">=</span> WebBaseLoader(<span style="color:#e6db74">&#34;https://www.gutenberg.org/files/1727/1727-h/1727-h.htm&#34;</span>)
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> loader<span style="color:#f92672">.</span>load()</span></span></code></pre></div>
    <button class="copy-btn absolute top-2 right-2 bg-zinc-600 hover:bg-zinc-900 transition duration-300 text-white rounded px-2 py-1 text-xs focus:outline-none" onclick="copyCodeToClipboard(this)">Copy</button>
</div>

<p>This file is pretty big. Just the preface is 3000 tokens. Which means the full document won&rsquo;t fit into the context for the model. So we need to split it up into smaller pieces.</p>
<div class="codeblock relative bg-zinc-800 rounded text-sm p-4">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain.text_splitter <span style="color:#f92672">import</span> RecursiveCharacterTextSplitter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>text_splitter<span style="color:#f92672">=</span>RecursiveCharacterTextSplitter(chunk_size<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>, chunk_overlap<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>all_splits <span style="color:#f92672">=</span> text_splitter<span style="color:#f92672">.</span>split_documents(data)</span></span></code></pre></div>
    <button class="copy-btn absolute top-2 right-2 bg-zinc-600 hover:bg-zinc-900 transition duration-300 text-white rounded px-2 py-1 text-xs focus:outline-none" onclick="copyCodeToClipboard(this)">Copy</button>
</div>

<p>It&rsquo;s split up, but we have to find the relevant splits and then submit those to the model. We can do this by creating embeddings and storing them in a vector database. We can use Ollama directly to instantiate an embedding model. We will use ChromaDB in this example for a vector database. <code>pip install chromadb</code></p>
<div class="codeblock relative bg-zinc-800 rounded text-sm p-4">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain.embeddings <span style="color:#f92672">import</span> OllamaEmbeddings
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain.vectorstores <span style="color:#f92672">import</span> Chroma
</span></span><span style="display:flex;"><span>oembed <span style="color:#f92672">=</span> OllamaEmbeddings(base_url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://localhost:11434&#34;</span>, model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;nomic-embed-text&#34;</span>)
</span></span><span style="display:flex;"><span>vectorstore <span style="color:#f92672">=</span> Chroma<span style="color:#f92672">.</span>from_documents(documents<span style="color:#f92672">=</span>all_splits, embedding<span style="color:#f92672">=</span>oembed)</span></span></code></pre></div>
    <button class="copy-btn absolute top-2 right-2 bg-zinc-600 hover:bg-zinc-900 transition duration-300 text-white rounded px-2 py-1 text-xs focus:outline-none" onclick="copyCodeToClipboard(this)">Copy</button>
</div>

<p>Now let&rsquo;s ask a question from the document. <strong>Who was Neleus, and who is in his family?</strong> Neleus is a character in the Odyssey, and the answer can be found in our text.</p>
<div class="codeblock relative bg-zinc-800 rounded text-sm p-4">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>question<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Who is Neleus and who is in Neleus&#39; family?&#34;</span>
</span></span><span style="display:flex;"><span>docs <span style="color:#f92672">=</span> vectorstore<span style="color:#f92672">.</span>similarity_search(question)
</span></span><span style="display:flex;"><span>len(docs)</span></span></code></pre></div>
    <button class="copy-btn absolute top-2 right-2 bg-zinc-600 hover:bg-zinc-900 transition duration-300 text-white rounded px-2 py-1 text-xs focus:outline-none" onclick="copyCodeToClipboard(this)">Copy</button>
</div>

<p>This will output the number of matches for chunks of data similar to the search.</p>
<p>The next thing is to send the question and the relevant parts of the docs to the model to see if we can get a good answer. But we are stitching two parts of the process together, and that is called a chain. This means we need to define a chain:</p>
<div class="codeblock relative bg-zinc-800 rounded text-sm p-4">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> langchain.chains <span style="color:#f92672">import</span> RetrievalQA
</span></span><span style="display:flex;"><span>qachain<span style="color:#f92672">=</span>RetrievalQA<span style="color:#f92672">.</span>from_chain_type(ollama, retriever<span style="color:#f92672">=</span>vectorstore<span style="color:#f92672">.</span>as_retriever())
</span></span><span style="display:flex;"><span>qachain<span style="color:#f92672">.</span>invoke({<span style="color:#e6db74">&#34;query&#34;</span>: question})</span></span></code></pre></div>
    <button class="copy-btn absolute top-2 right-2 bg-zinc-600 hover:bg-zinc-900 transition duration-300 text-white rounded px-2 py-1 text-xs focus:outline-none" onclick="copyCodeToClipboard(this)">Copy</button>
</div>

<p>The answer received from this chain was:</p>
<blockquote>
<p>Neleus is a character in Homer&rsquo;s &ldquo;Odyssey&rdquo; and is mentioned in the context of Penelope&rsquo;s suitors. Neleus is the father of Chloris, who is married to Neleus and bears him several children, including Nestor, Chromius, Periclymenus, and Pero. Amphinomus, the son of Nisus, is also mentioned as a suitor of Penelope and is known for his good natural disposition and agreeable conversation.</p>
</blockquote>
<p>It&rsquo;s not a perfect answer, as it implies Neleus married his daughter when actually Chloris &ldquo;was the youngest daughter to Amphion son of Iasus and king of Minyan Orchomenus, and was Queen in Pylos&rdquo;.</p>
<p>I updated the chunk_overlap for the text splitter to 20 and tried again and got a much better answer:</p>
<blockquote>
<p>Neleus is a character in Homer&rsquo;s epic poem &ldquo;The Odyssey.&rdquo; He is the husband of Chloris, who is the youngest daughter of Amphion son of Iasus and king of Minyan Orchomenus. Neleus has several children with Chloris, including Nestor, Chromius, Periclymenus, and Pero.</p>
</blockquote>
<p>And that is a much better answer.</p>

  </div>
  <div class="p-4">
    
<div class="mt-8 flex justify-between items-center">
    
        <a href="/tutorials/langchainjs/" class="tile text-black py-2 px-4 rounded-r-md transition duration-300">  </a>
    

    
        <a href="/tutorials/nvidia-jetson/" class="tile text-black py-2 px-4 rounded-l-md transition duration-300">  </a>
    
</div>
  </div>

    </div><div id="searchResultsContainer" class="hidden w-full lg:w-3/5 p-4" data-productFilter="">
    
</div><aside id="sidebar-right" class="hidden lg:block w-60">
  
    <div id="tocContainer" class="hidden toc sticky top-10 pt-4 h-[calc(100vh-4rem)] overflow-y-auto text-sm text-black transition duration-300"> 
    <nav id="TableOfContents"></nav>
</div>
  
  
    <div id="chatContainer" class="hidden sticky top-16 h-[calc(100vh-5rem)] flex flex-col flex justify-end">
    <div id="chat-messages" class="flex flex-col overflow-y-auto text-base">
    </div>
    <div id="chat-controls" class="flex flex-row text-xs mt-2">
        <form id="chat-form" class="flex flex-row">
            <input id="question" type="text" aria-label="Question Input" placeholder="Ask the docs" class="h-10 border rounded-lg p-1 mr-1 focus:outline-none focus:ring-2 focus:ring-brand" />
            <button id="sendButton" aria-label="Send" class="flex items-center bg-brand my-1  hover:bg-black text-white p-1 mr-1 rounded-lg shadow-lg transition duration-300"><img src="/icons/send.svg" alt="Send" class="w-5 h-5"></button>
        </form>
        <button id="clearAll" aria-label="Delete All"  class="flex items-center bg-black my-1 hover:bg-red-600 text-white p-1 rounded-lg shadow-lg transition duration-300"><img src="/icons/delete.svg" alt="Delete" class="w-5 h-5"></button>
    </div>
</div>
  
</aside>
</main>
  <footer>


<script src="https://cdn.jsdelivr.net/npm/algoliasearch@latest/dist/algoliasearch-lite.umd.js" defer></script>
</footer>
</body>
</html>
